#!/bin/bash

# Task 3: Summarize PokÃ©mon Data
# Generate CSV report and calculate averages

DATA_DIR="pokemon_data"
OUTPUT_CSV="pokemon_report.csv"

# Check if data directory exists
if [ ! -d "$DATA_DIR" ]; then
    echo "Error: $DATA_DIR directory not found!"
    exit 1
fi

# Create CSV header
echo "Name,Height (m),Weight (kg)" > "$OUTPUT_CSV"

# Process each JSON file
for json_file in "$DATA_DIR"/*.json; do
    if [ -f "$json_file" ]; then
        # Extract name
        name=$(jq -r '.name' "$json_file" | sed 's/\b\w/\u&/')
        
        # Extract height (convert from decimeters to meters)
        height=$(jq '.height' "$json_file" | awk '{printf "%.1f", $1/10}')
        
        # Extract weight (convert from hectograms to kg)
        weight=$(jq '.weight' "$json_file" | awk '{printf "%.1f", $1/10}')
        
        # Append to CSV
        echo "$name,$height,$weight" >> "$OUTPUT_CSV"
    fi
done

# Display report header
echo "CSV Report generated at: $OUTPUT_CSV"
echo ""
cat "$OUTPUT_CSV"
echo ""

# Calculate averages using awk
awk -F',' '
    NR > 1 {
        sum_height += $2
        sum_weight += $3
        count++
    }
    END {
        if (count > 0) {
            avg_height = sum_height / count
            avg_weight = sum_weight / count
            printf "Average Height: %.2f m\n", avg_height
            printf "Average Weight: %.2f kg\n", avg_weight
        }
    }
' "$OUTPUT_CSV"